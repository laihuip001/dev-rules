  
### 🏥 Module C-7: Surgical Prompt Refactoring (プロンプト外科手術)


**【強化ポイント】**

1.  **Structure Hardening:** 自然言語混じりの指示を、強制的にXMLタグ（`<instruction>`, `<rules>`等）でラッピングし、解釈ブレをゼロにします。

2.  **Ambiguity Killer:** 「いい感じに」等の形容詞を検知し、自動的に定量的な制約（文字数、フォーマット指定）に変換します。

3.  **CoT Injection:** 複雑な推論を求めているのに `<thinking_process>` がない場合、自動的に思考プロセス出力タグを挿入します。

  

```xml

<module_instruction id="C-7">

  <mode>Surgical Prompt Refactoring (Optimization)</mode>

  <objective>

    直前の `<audit_report>` (Module C-6の出力) に基づき、対象のプロンプトを再構築し、プロダクション品質の「最適化プロンプト」を出力する。

  </objective>

  

  <input_source>

    <audit_data>Module C-6 の出力 (&lt;structural_flaws&gt;, &lt;ambiguity_detection&gt;, &lt;missing_components&gt;)</audit_data>

    <original_draft>監査対象となった元のプロンプト</original_draft>

  </input_source>

  

  <refactoring_protocol>

    <step_1>**Structural Hardening (構造の堅牢化):**

      - プレーンテキストの指示を、意味単位でXMLタグ（`<instruction>`, `<constraints>`, `<output_format>`）に格納し、構造化する。

      - 入力変数（`{{INPUT}}`）と命令文の境界をタグで物理的に分離する。

    </step_1>

    <step_2>**Semantic Disambiguation (曖昧性の排除):**

      - `<ambiguity_detection>` で指摘された単語を、具体的数値（例: 「200文字」）、定義、または制限事項に置換する。

      - 「禁止事項（Negative Constraints）」を `<negative_constraint>` タグで明示的に定義する。

    </step_2>

    <step_3>**Component Injection (機能注入):**

      - `<missing_components>` で指摘された要素（特に `<thinking_process>` によるCoT）を実装し、推論精度を担保する。

    </step_3>

  </refactoring_protocol>

  

  <strict_constraints>

    <constraint type="NO_TRUNCATION">

      **省略の完全禁止:** プロンプト全体を必ず再出力すること。`# ...` や「（中略）」は固く禁ずる。

    </constraint>

    <constraint type="NO_META_COMMENTARY">

      修正の意図や解説は不要。`<optimized_prompt>` タグの中身のみを出力せよ。

    </constraint>

  </strict_constraints>

  

  <output_schema>

    <optimized_prompt>

      (修正済みの完全なプロンプトコード。Markdownコードブロック形式で記述)

    </optimized_prompt>

  </output_schema>

</module_instruction>